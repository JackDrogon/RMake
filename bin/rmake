#!/usr/bin/env ruby
# frozen_string_literal: true

$LOAD_PATH.unshift File.expand_path('../lib', __dir__)

require 'rmake/cli'

# TODO(Drogon): Add argparse

RMAKEFILE = 'rmakefile'
ENV_INDENT = '_indent_'

def main
  target_name = nil
  target_name = ARGV[0] unless ARGV.empty?

  rmake = CLI.new(Env.new(ENV.to_h), RMAKEFILE, target_name)
  puts '================================='
  puts '----- list targets -----'
  puts rmake.list_targets
  puts '================================='

  rmake.run
end

main if $LAST_READ_LINE != __FILE__
