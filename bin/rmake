#!/usr/bin/env ruby
# frozen_string_literal: true

$LOAD_PATH.unshift File.expand_path('../lib', __dir__)

require 'rmake/cli'

# TODO(Drogon): Add argparse

# The default name of the RMakefile
RMAKEFILE = 'rmakefile'

# The environment indent
ENV_INDENT = '_indent_'

# The main function that runs the CLI and executes the target
def main
  target_name = nil
  target_name = ARGV[0] unless ARGV.empty?

  rmake = CLI.new(Env.new(ENV.to_h), RMAKEFILE, target_name)
  puts '================================='
  puts '----- list targets -----'
  puts rmake.list_targets
  puts '================================='

  rmake.run
end

# Call the main function if the last read line is not the current file
main if $LAST_READ_LINE != __FILE__
